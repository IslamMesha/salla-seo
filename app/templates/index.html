{% load custom_filters %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salla SEO Plugin</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
        integrity="sha512-wnea99uKIC3TJF7v4eKk4Y+lMz2Mklv18+r4na2Gn1abDRPPOeef95xTzdwGD9e6zXJBteMIhZ1+68QC5byJZw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body class="p-8 bg-gray-100 select-none">
    <h1 class="text-3xl font-bold text-center text-black">Welcome to Salla SEO Plugin.</h1>
    
    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
        <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>
            {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}Important: {% endif %}
            {{ message }}
        </li>
        {% endfor %}
    </ul>
    {% endif %}

    <div class="text-center mt-10">
        <a class="border-2 px-3 py-1 border-black bg-red-600 text-white font-bold" target="_blank"
            href="{{ installation_url }}">Install the APP</a>
    </div>
    <div class="products pt-12 flex flex-wrap">
        {% for product in products %}
        <div class="
            product bg-white w-56 rounded-md overflow-hidden mb-4
            flex-shrink-0 flex-grow mx-2 flex flex-col
        ">
            <div class="product-image">
                <img src="{{ product.main_image }}"
                    alt="Product Image">
            </div>
            <div class="product-info px-4 py-5">
                <h3 class="product-title font-bold mb-2">{{ product.name }}</h3>
                <p class="product-description text-sm break-all">{{ product.description }}</p>
                <p class="product-price text-right">{{ product.price.amount }} {{ product.price.currency }}</p>
            </div>

            <div class="bottom-0 flex-grow flex flex-col-reverse">
                <button 
                    class="block bg-red-300 w-full font-bold text-white py-2 bottom-0"
                    data-product="{{ product|to_json }}"
                >Get Description</button>
            </div>
        </div>
        {% endfor %}

    </div>

    <script>
        const buttons = document.querySelectorAll('button[data-product]');
        buttons.forEach(button => {
            button.addEventListener('click', () => {
                const product = button.getAttribute('data-product');
                const url = '/product/get-description/';

                fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: product
                })
                    .then(response => response.json())
                    .then(data => {
                        const description = data.description;
                        console.log(description);
                        const descriptionElement = button.parentElement.previousElementSibling.querySelector('.product-description');
                        descriptionElement.innerText = description;
                    });

            });
        });
    </script>

</body>

</html>